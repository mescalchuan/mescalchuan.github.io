

	<!DOCTYPE html>
	<html class="scrollbar">
		

<head><meta name="generator" content="Hexo 3.8.0">
  <meta name="referrer" content="no-referrer">
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <title>
    
      近日使用React Native Linking踩过的坑 | Mescal 川
    
  </title>
  <meta name="author" content="Mescal Chuan">
  <meta name="keywords" content>
  <meta name="description" content>
	<!-- favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico">

  <!-- css -->
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

    <!-- jquery -->
	<script src="/js/jquery-2.1.1.min.js"></script>

  <!-- leancloud -->
  
  <link rel="stylesheet" href="/css/prismCustom.css">
  <link rel="stylesheet" href="/css/remodal.css">
  <link rel="stylesheet" href="/css/remodal-default-theme.css">
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
	<body class="language-js">
		<!-- Preloader -->

	<div id="preloader">
		<div class="pre-container">
			
				<div class="transition">
					<div class="three-bounce1"></div>
					<div class="three-bounce2"></div>
					<div class="three-bounce3"></div>
				</div>
						
		</div>
	</div>


<!-- header -->
<header class="fixbackground" data-img-mode="normal" data-normal-src="/img/48.jpg" data-random-max="110" data-random-src="https://sariay.github.io/Random-img/">
	<div class="mask">
		<div class="h-header">
			<div id="logo-S">
				
					<a href="/">
						Mescal
					</a>
				
			</div>
			<!-- Navigation in header(id="navigation-S") -->
			<div id="navigation-S">
				<ul>
					
						<li class="menu-home">
							<a href="/" class="menu-item-home">主页</a>
						</li>
					
						<li class="menu-archive">
							<a href="/archives" class="menu-item-archive">归档</a>
						</li>
					
						<li class="menu-categories">
							<a href="/categories" class="menu-item-categories">分类</a>
						</li>
					
						<li class="menu-tags">
							<a href="/tags" class="menu-item-tags">标签</a>
						</li>
					
						<li class="menu-about">
							<a href="/about" class="menu-item-about">关于</a>
						</li>
					
						<li class="menu-gallery">
							<a href="/gallery" class="menu-item-gallery">摄影集</a>
						</li>
					

					
						<li class="menu-search">
							<a href="javascript:;" class="popup-trigger" title="Search">搜索</a>
						</li>
					
				</ul>			
			</div>				
		</div>

		<div class="h-body">	
			<!-- motto -->
			
				<div id="page-motto">
					<p class="motto">
						
					</p>
				</div>
			

			<div id="navigation-H">
				<!-- Page title -->
				<p>
					
						当前文章&nbsp;:&nbsp;《近日使用React Native Linking踩过的坑》
					
				</p>
				<!-- Progress bar -->
				<div id="progress-bar"></div>

				<!-- Progress percent -->
				<div id="progress-percentage">
					<h1>0.0%</h1>
				</div>
			</div>
		</div>
		
		<!-- others: such as time... -->			
		<div class="h-footer">
			<ul>
				<!-- <li>
					<a><i class="fa fa-camera-retro" onclick="changeHeaderBg()"></i>切换背景</a>
				</li> -->
				<li>
					<a href="javascript:;" id="read-more"><i class="fa fa-angle-double-down"></i></a>
				</li>
				<!-- <li>
					<a href="https://github.com/Sariay/hexo-theme-Annie" target="_blank"><i class="fa fa-download"></i>克隆主题</a>
				</li> -->
			</ul>
		</div>
		
		<!-- This is only a demo, please go to "https://time.is" to set your city time! -->
<style type="text/css">
	.header-date {
		position: absolute;
		left: 40px;
		bottom: 30px;
		writing-mode: tb-rl;
		font-size: 36px;
	}	
	.header-date a {
		border-bottom: none;
	}
	@media only screen and (max-width: 768 ) {
		.header-date {
			position: absolute;
			left: 40px;
			bottom: 30px;
			writing-mode: tb-rl;
			font-size: 20px;
		}			
	}
</style>
<div class="header-date">
	<a href="https://time.is/Beijing" id="time_is_link" rel="nofollow"></a>
	<span id="Beijing_z43d"></span>
</div>
<script src="//widget.time.is/zh.js"></script>
<script>
	time_is_widget.init({
		Beijing_z43d:{
			template:"DATE", 
			date_format:"year年 monthname dnum日"
		}
	});
</script>
</div></header>

<!-- Navigation in div(id="navigation-H") -->
<a class="nav-trigger">
	<span></span>
</a>

<nav class="nav-container" id="cd-nav">
	<div class="nav-header">
		<h3>Navigation</h3>
		<a href="javascript:;" class="nav-close"></a>
	</div>
	<div class="nav-body">
		<ul>
			
				<li class="menu-home">
					<a href="/" class="menu-item-home">主页</a>
				</li>
			
				<li class="menu-archive">
					<a href="/archives" class="menu-item-archive">归档</a>
				</li>
			
				<li class="menu-categories">
					<a href="/categories" class="menu-item-categories">分类</a>
				</li>
			
				<li class="menu-tags">
					<a href="/tags" class="menu-item-tags">标签</a>
				</li>
			
				<li class="menu-about">
					<a href="/about" class="menu-item-about">关于</a>
				</li>
			
				<li class="menu-gallery">
					<a href="/gallery" class="menu-item-gallery">摄影集</a>
				</li>
			

			
				<li class="menu-search">
					<a href="javascript:;" class="popup-trigger" title="Search">搜索</a>
				</li>
			
		</ul>
	</div>

	<div class="nav-footer">
		<ul>
	
		
			<li>
				<a href="https://github.com/mescalchuan" title="Github" target="_blank">
					<i class="fa fa-github"></i>
				</a>
			</li>
		
		
			<li>
				<a href="https://weibo.com/6454388854/profile?topnav=1&wvr=6" title="Weibo" target="_blank">
					<i class="fa fa-weibo"></i>
				</a>
			</li>
		
		
			<li>
				<a href="mailto:/1335382915@qq.com" title="Email" target="_blank">
					<i class="fa fa-envelope-o"></i>
				</a>
			</li>
		

		
			<li>
				<a href="javasvript:void(0)" title="QQ" target="_blank" data-remodal-target="modalQ">
					<i class="fa fa-qq"></i>
				</a>
			</li>
		
		
			<li>
				<a href="javasvript:void(0)" title="WeiXin" target="_blank" data-remodal-target="modalW">
					<i class="fa fa-weixin"></i>
				</a>
			</li>
		
		
			<li>
				<a href="https://mescalchuan.github.io" title="Website">
					<i class="fa fa-globe"></i>
				</a>
			</li>
		
		
	 
</ul>
	</div>
</nav>

		
		<!--main-->
		<main>
			<div class="layout-post">
	
	
	<div class="article-title">
		
	<a href="/2017/11/20/2017-11-20-technology-react-native-linking/" itemprop="url">
		近日使用React Native Linking踩过的坑
	</a>

	</div>

	<div class="article-meta">
		<span>
			
	发布于
	<a href="/2017/11/20/2017-11-20-technology-react-native-linking/" itemprop="url">
		<time datetime="2017-11-20T10:32:20.000Z" itemprop="datePublished">
	  		2017-11-20
	  </time>
	</a> 

	/
	更新于
	<a href="/2017/11/20/2017-11-20-technology-react-native-linking/" itemprop="url">
		<time datetime="2017-11-20T10:32:20.000Z" itemprop="dateUpdated">
	  		2019-04-26
	  </time>
	</a> 	

		</span>
		/
		<span>
			<i class="fa fa-tags"></i>
			
	
		<a href="/tags/博客/" class=" ">
			博客
		</a>
	
		<a href="/tags/技术博客/" class=" ">
			技术博客
		</a>
	
		<a href="/tags/react-native/" class=" ">
			react-native
		</a>
	
		
		</span>
		<!-- /
		


 -->
	</div>

	<div class="article-content" id="article-content">
		<p>使用react native（以下简称rn）开发移动端app已经有四个月的时间了（包括第一个月的上手），感谢rn，让前端开发人员也能够开发原生的app。前几天遇到一个需求：打开第三方的支付应用并监听返回的结果。听上去这个需求并不难，然而使用rn来实现就会遇到大大小小的坑。为了能让其他开发人员少走弯路，在这里总结一下。</p>
<h3 id="使用Linking"><a href="#使用Linking" class="headerlink" title="使用Linking"></a>使用Linking</h3><p>写这篇博客的原因还有一个：网上有很多关于Linking的博客，然而有深度的文章少之又少，大部分都是简单介绍了Linking的使用方法（我搜过好几篇文章内容和代码都是一样的）。</p>
<h4 id="Linking基本使用方法"><a href="#Linking基本使用方法" class="headerlink" title="Linking基本使用方法"></a>Linking基本使用方法</h4><p>这里我建议去rn的<a href="http://reactnative.cn/" target="_blank" rel="noopener">中文官网</a>学习，那里讲解的十分详细。通过查看文档我们了解到，Linking使用url来唤起系统应用或链接。其实Linking还可以唤起其他的app，前提条件是你的手机上已经安装了它。</p>
<h4 id="唤起其他app"><a href="#唤起其他app" class="headerlink" title="唤起其他app"></a>唤起其他app</h4><p>使用Linking唤起其他app比较简单，只需要简单的两个步骤：1.检查该app能否被唤起，也就是检查该app是否已安装成功；2.唤起并传递参数。</p>
<p>Linking提供了canOpenURL这个方法，用来检测某个url是否可以打开：</p>
<pre><code>Linking.canOpenURL(&#39;appName://&#39;).then(canOpen=&gt;{
    ...
})
</code></pre><p>使用Linking打开app也比较简单，调用openURL方法即可：</p>
<pre><code>Linking.openURL(&#39;appName://?params&#39;);
</code></pre><p>为了方便演示，我准备了两个app：lka和lkb。这两个应用功能比较简单，只含有一个button，点击的时候唤起另外一个app，同时传递参数。被唤起的app获取参数并alert出来。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-6d2696551a740f1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-3c1bf87a4b4e04a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>现在，我需要在lka里唤起lkb，代码是这样的：</p>
<pre><code>Linking.canOpenURL(&#39;lkb://&#39;).then(canOpen=&gt;{
    if(canOpen){
        Linking.openURL(&#39;lkb://?orderId=1&#39;);
    }
});
</code></pre><p>你如果直接点击button的话是肯定不会跳转的，因为canOpen是false。可能有些人会问：我明明已经安装了lkb，为什么会打不开？这里就要说到scheme了，我们可以把它理解为一个app的标识，当url的协议部分与scheme匹配时，app就会被打开。</p>
<p>我们需要在AndroidManifest.xml里进行相关的配置：</p>
<pre><code>&lt;activity
    android:name=&quot;.MainActivity&quot;
/*add  --&gt;*/ android:launchMode=&quot;singleTask&quot;
    android:label=&quot;@string/app_name&quot;
    android:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize&quot;
    android:windowSoftInputMode=&quot;stateAlwaysHidden|adjustPan&quot;
&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
        &lt;action android:name=&quot;android.intent.action.DOWNLOAD_COMPLETE&quot;/&gt;    
    &lt;/intent-filter&gt;
/*add start*/
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
        &lt;data android:scheme=&quot;lka&quot; /&gt;
    &lt;/intent-filter&gt;
/*add end*/
&lt;/activity&gt;
</code></pre><p>我们添加了两块代码：launchMode和intent-filter。关于launchMode可以参考<a href="http://blog.csdn.net/liuhe688/article/details/6754323/" target="_blank" rel="noopener">这篇文章</a>学习。我们新添加了一个intent-filter，关于intent-filter的相关知识可以自行上网搜索。Intent-filter顾名思义就是意图过滤器，它就像过滤器一样筛选每次传过来的url，只要有符合条件的url就会执行intent-filter里面的相关操作。</p>
<p>在本代码中，我们在intent-filter里配置了scheme，只要url的协议为lka就会打开lka app。请注意，不要把两个intent-filter合并到一起，虽然你的app能够正常运行，但是你将会在手机上找不到app的图标。</p>
<p>再次点击openLkb按钮，唤起成功。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-074f7cd65f5672d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<pre><code>//lkb
componentDidMount(){
    Linking.getInitialURL().then(url=&gt;{
        alert(url);
    })
}
</code></pre><h4 id="开始踩坑"><a href="#开始踩坑" class="headerlink" title="开始踩坑"></a>开始踩坑</h4><p>现在，lka已经能够成功唤起lkb了，并且传递的参数在lkb里也能接收到，那么反过来也是一样的？现在我们增加一下需求，只要lka从后台运行到了前台或者首次打开均弹出url。</p>
<p>实现起来比较简单，我们需要监听app的运行状态，需要用到AppState：</p>
<pre><code>//lka
import {
    Linking,
    AppState
} from &#39;react-native&#39;
...
componentDidMount(){
    AppState.addEventListener(&#39;change&#39;,(appState)=&gt;{
        if(appState==&#39;active&#39;){
            Linking.getInitialURL().then(url=&gt;{
                alert(&#39;stateChange&#39;+url)        
            })
        }
    })
    Linking.getInitialURL().then(url=&gt;{
        alert(&#39;didmount:&#39;+url);
    })
}
</code></pre><pre><code>//lkb
openLka(){
    Linking.canOpenURL(&#39;lka://&#39;).then(res=&gt;{
        if(res){
            Linking.openURL(&#39;lka://?name=sunnychuan&amp;age=23&#39;);
        }
    });
}
</code></pre><p>同样的，为lka配置好AndroidManifest.xml，把scheme配置成lka。我们首先把lka关掉，然后在lkb里唤起它，结果如下：</p>
<p>!](<a href="http://upload-images.jianshu.io/upload_images/1495096-99ec56ea6225f449.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener">http://upload-images.jianshu.io/upload_images/1495096-99ec56ea6225f449.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240</a>)</p>
<p>我们通过任务管理切回到lkb，然后点击按钮再次唤起lka，你得到的结果还是正确的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-8b80d0e126a79227.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>先别急着高兴，我们把lka和lkb都关掉，重新打开lka，你将得到“didmount:null”的结果。这是当然的，因为你是自己打开的嘛。</p>
<p>然后，我们通过lka唤起lkb，再通过lkb唤起lka，你得到的结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-3b6ae4208b0c8614.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>发现问题没有？你可以多尝试几次，最终会发现一个规律：<code>AppState.addEventListener</code>里面获取的url的值永远与<code>componentDidMount</code>里直接获取的url的值相同。只要首次获取的是null，那么以后永远都是null；只要首次获取的是有值的，那么以后永远都是有值的。</p>
<p>我们看一下Linking的源码吧：</p>
<pre><code>//node_modules/react-native/ReactAndroid/src/main/java/com/facebook/react/modules/intent/IntentModule.java
...
@ReactMethod
public void getInitialURL(Promise promise) {
    try {
        Activity currentActivity = getCurrentActivity();
        String initialURL = null;
        if (currentActivity != null) {
            Intent intent = currentActivity.getIntent();
            String action = intent.getAction();
            Uri uri = intent.getData();
            if (Intent.ACTION_VIEW.equals(action) &amp;&amp; uri != null) {
                initialURL = uri.toString();
            }
        }
        promise.resolve(initialURL);
    } catch (Exception e) {
        promise.reject(new JSApplicationIllegalArgumentException(
        &quot;Could not get the initial URL : &quot; + e.getMessage()));
      }
}
</code></pre><p>每一次调用getInitialURL，android端都会获取当前的activity，并且返回activity对象里面的data值（uri）。</p>
<p>我们可以把<code>AppState.addEventListener</code>里面获取的url称为脏数据。通过上网翻阅相关资料后我发现，原生的android跳转其实是activity之间的跳转。现在回过头来看一下我们的xml，只有一个activity。你可以尝试一下把activity拆成两个，其中一个专门用来配置scheme，运行结果并不符合我们的预期。</p>
<p>原因是什么呢？这是因为react native只配置了一个activity，整个应用都是在这个activity里运行的。当lka尚未启动，由lkb唤起时，lka的activity会执行<code>onCreate</code>生命周期钩子，初始化intent，此时你将会得到全新的url：null。当lka已经运行在后台，由lkb唤起时，lka的activity不会执行<code>onCreate</code>方法，你得到的url还是旧值：null。</p>
<p>解决方案参考了<a href="http://blog.csdn.net/langtuteng136/article/details/44812143" target="_blank" rel="noopener">这篇文章</a>，在android/app/src/main/java/com/lka/MainActivity.java的最下面添加：</p>
<pre><code>@Override
public void onNewIntent(Intent intent){
    super.onNewIntent(intent);
    setIntent(intent);
}
</code></pre><p>重新打包之后（每次修改android文件夹里面的东西后都需要重新打包才能生效），我们再尝试一下：1.关掉lka和lkb；2.打开lka，你会收到null值；3.唤起lkb；4.由lkb唤起lka。你得到的结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-5845a4bd1d79f007.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>结果与我们的预期相符。</p>
<h4 id="另一个问题"><a href="#另一个问题" class="headerlink" title="另一个问题"></a>另一个问题</h4><p>其实这里还有一个潜在的问题。同样的，通过lkb唤起lka，你将接收到正确的参数“lka://?name=sunnychuan&amp;age=23”。然后，我们手动将lka运行在后台，然后重新让它运行在前台（不通过lkb唤起），你得到的值依旧是“lka://?name=sunnychuan&amp;age=23”。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-9672a81807011a27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-69af5e5627a24df4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-7700b392b795e363.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>从代码上来看，这个结果是正确的，因为没有人更改activity的url，所以值一直没有改变；从需求上来看，这个结果是不正确的。我们假设lka在监听函数里获取url的参数，如果url有参数就跳转到支付成功页面。现在，只要lka由后台运行到前台都会跳转到支付成功页面（没准真的有用户喜欢来回切换应用）。这样显然是不合理的，我们期望的是：只有lka是由lkb唤起的（无论lka已经运行在后台还是尚未启动），才会跳转到支付成功页面。</p>
<p>我的思路是，在<code>getInitialURL.then</code>里，首先将activity的intent重置成默认值，这需要我们自己封装android方法，我们先看一下封装后的代码：</p>
<pre><code>//lka
import {
    Linking,
    AppState,
    NativeModules
} from &#39;react-native&#39;
...
componentDidMount(){
    AppState.addEventListener(&#39;change&#39;,(appState)=&gt;{
        if(appState==&#39;active&#39;){
            Linking.getInitialURL().then(url=&gt;{
                NativeModules.LinkingCustom.resetURL().then(()=&gt;{
                    alert(&#39;stateChange&#39;+url)
                });        
            })
        }
    })
    Linking.getInitialURL().then(url=&gt;{
        NativeModules.LinkingCustom.resetURL().then(()=&gt;{
            alert(&#39;didmount&#39;+url)
        });    
    })
}
</code></pre><p>下面我们来为lka封装一下这个方法，如果你是安卓工程师，这点操作就是小儿科；如果你是前端工程师，并且对安卓不了解，跟着我一步一步写，很简单。</p>
<h4 id="CustomLinking"><a href="#CustomLinking" class="headerlink" title="CustomLinking"></a>CustomLinking</h4><p>首先，我们需要在与MainActivity.java同级的目录下新建一个java文件，导入必要的java包：</p>
<pre><code>//android/app/src/main/java/com/lka/LinkingCustom.java
package com.lka;
import android.app.Activity;
import android.content.ComponentName;
import android.content.Intent;
import android.net.Uri;
import com.facebook.react.bridge.JSApplicationIllegalArgumentException;
import com.facebook.react.bridge.Promise;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.ReactMethod;
import com.facebook.react.module.annotations.ReactModule;
</code></pre><p>其次，创建CustomLinking类，你需要继承ReactContextBaseJavaModule类，并实现getName函数。这里的getName函数是必须的，返回值就是你在js端通过NativeModules拿到的模块名”LinkingCustom”一致：</p>
<pre><code>public class LinkingCustom extends ReactContextBaseJavaModule {
    public LinkingCustom(ReactApplicationContext reactContext) {
        super(reactContext);
    }
    @Override
    public String getName() {
        return &quot;LinkingCustom&quot;;
    }
}
</code></pre><p>然后，我们实现重置intent的函数，将其命名为resetURL：</p>
<pre><code>...
@Override
public String getName() {
    return &quot;LinkingCustom&quot;;
}
//必须添加@ReactMethod关键字才能在js侧被调用
@ReactMethod
//不可以直接将结果return，因为js侧是异步获取结果的，这里将结果返回成promise，
public void resetURL(Promise promise) {
    try {
        Activity currentActivity = getCurrentActivity();
        if (currentActivity != null) {
            Intent intent = new Intent(Intent.ACTION_MAIN);
            currentActivity.setIntent(intent);
        }
        promise.resolve(true);
    } catch (Exception e) {
        promise.reject(new JSApplicationIllegalArgumentException(&quot;Could not reset URL&quot;));
      }
}
</code></pre><h4 id="LinkingCustomReactPackage"><a href="#LinkingCustomReactPackage" class="headerlink" title="LinkingCustomReactPackage"></a>LinkingCustomReactPackage</h4><p>我们在同级下新建LinkingCustomReactPackage.java文件，用来注册模块：</p>
<pre><code>//android/app/src/main/java/com/lka/LinkingCustomReactPackage.java
package com.coomarts;
import com.facebook.react.ReactPackage;
import com.facebook.react.bridge.JavaScriptModule;
import com.facebook.react.bridge.NativeModule;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.uimanager.ViewManager;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
//必须实现ReactPackage接口和createNativeModules方法
public class LinkingCustomReactPackage implements ReactPackage{
    @Override
    public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext){
        List&lt;NativeModule&gt; modules=new ArrayList&lt;&gt;();
        //在这里添加你想注册的模块
        modules.add(new LinkingCustom(reactContext));
        return modules;
    }

    @Override
    public List&lt;Class&lt;? extends JavaScriptModule&gt;&gt; createJSModules(){
        return Collections.emptyList();
    }

    @Override
    public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContent){
        return Collections.emptyList();
    }
}
</code></pre><h4 id="为包管理添加实例"><a href="#为包管理添加实例" class="headerlink" title="为包管理添加实例"></a>为包管理添加实例</h4><p>最后一步就是在MainApplication.java里添加实例，与添加第三方组件实例相同：</p>
<pre><code>//android/app/src/main/java/com/lka/MainApplication.java
...
@Override
protected List&lt;ReactPackage&gt; getPackages() {
    return Arrays.&lt;ReactPackage&gt;asList(
        new SQLitePluginPackage(),
        new MainReactPackage(),
        new RNDeviceInfo(),
        new VectorIconsPackage(),
        new LinkingCustomReactPackage()
    );
}
</code></pre><p>大功告成，现在我们重复之前的步骤，看一下运行结果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-9672a81807011a27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-69af5e5627a24df4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1495096-3b6ae4208b0c8614.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>除非lka是由lkb唤起的，否则在其他情况下运行lka得到的均是null值。</p>
	
	</div>
	
	<div id="current-post-cover" data-scr="/img/mescal/7.jpg"></div>

	<!-- relate post, comment...-->
	<div class="investment-container">
		<div class="investment-header">
			<div class="investment-title-1">
				<div class="on">相关文章</div>
				<!-- <div>评论</div> -->
			</div>
			<div class="investment-title-2">	            
				
	<span>
		<a href="javascript: window.scrollTo(0, 0);">返回顶部</a>
		
			<a href="/2018/01/19/2018-01-19-technology-react-native-textinput/" title="React Native之巧用TextInput" rel="prev">
				&laquo;上一篇
			</a>
		
		
			<a href="/2017/11/15/2017-11-15-technology-webpack-config/" title="Webpack工程化配置" rel="next">
				下一篇&raquo;
			</a>
			
	</span>
      		
			</div>	
		</div>
		
		<div class="investment-content">
			<div class="investment-content-list">
				

<div class="relate-post">
	<ul>
		
				<li>
					<div>
						<a href="/2019/10/16/2019-10-16-technology-css-block/" title="Css Block">
							Css Block
						</a>
						<p>
							CSS-BLOCK文档地址
初衷Css Block 启发于前不久阅读的张鑫旭的《CSS世界》一书，让我对 css 又有了新的理解，并且从中学到了一些“妙招”。日常项目中频频会用到一些常用的样式代码块，这些代码块可以封装到一个通用的样式...
						</p>
					</div>

					<a href="/2019/10/16/2019-10-16-technology-css-block/" title="Css Block">				
						<img src="/img/mescal/18.jpg" class="relateImg" alt="Css Block">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2019/05/10/2019-05-10-technology-async-rules-form/" title="IVIEW 动态校验规则组件">
							IVIEW 动态校验规则组件
						</a>
						<p>
							async-rules-form动态配置 iview 的表单规则
初衷实现 iview 的Form 组件可以动态修改校验规则的功能。
需求场景例如：当用户年龄下拉框选择“未成年”时，身份证号为非必填项，否则为必填项。
原理为该字段生成...
						</p>
					</div>

					<a href="/2019/05/10/2019-05-10-technology-async-rules-form/" title="IVIEW 动态校验规则组件">				
						<img src="/img/mescal/17.jpg" class="relateImg" alt="IVIEW 动态校验规则组件">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/09/27/2018-09-27-technology-vue-app-cli/" title="快速开发基于vue的app应用——vue-app-cli">
							快速开发基于vue的app应用——vue-app-cli
						</a>
						<p>
							
一个能够让你快速构建基于vue的app多页应用脚手架，可独立开发h5 app或集成到hbuilder开发原生应用。文档地址vue-cli之所以不使用官方的vue-cli构建应用是因为：

vue-cli需要自己实现多页面构建。
在开...
						</p>
					</div>

					<a href="/2018/09/27/2018-09-27-technology-vue-app-cli/" title="快速开发基于vue的app应用——vue-app-cli">				
						<img src="/img/mescal/1.jpg" class="relateImg" alt="快速开发基于vue的app应用——vue-app-cli">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/08/29/2018-08-29-technology-weixin/" title="初探微信小程序之小川天气">
							初探微信小程序之小川天气
						</a>
						<p>
							微信小程序可以说是当下很火热的应用了。在好奇心的作用下，通读了一遍之后便开始上手撸了一个很简单的天气应用——小川天气。



目前已经发布正式版本，你可以直接在微信中搜索小川天气来使用。
小程序的文档已经很完善了，通读一遍后上手写代码...
						</p>
					</div>

					<a href="/2018/08/29/2018-08-29-technology-weixin/" title="初探微信小程序之小川天气">				
						<img src="/img/mescal/xiaochuan_weather.jpg" class="relateImg" alt="初探微信小程序之小川天气">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/07/31/2018-07-31-technology-node-health/" title="基于React和Node实现一个食物热量参考应用">
							基于React和Node实现一个食物热量参考应用
						</a>
						<p>
							利用业余时间，自己做了一个食物热量参考网站，数据参考自一个app食物库。技术栈使用了sass+react+react-router+redux+antd+express+mongoose。

一、How To Use下载首先将代码cl...
						</p>
					</div>

					<a href="/2018/07/31/2018-07-31-technology-node-health/" title="基于React和Node实现一个食物热量参考应用">				
						<img src="/img/mescal/node_health.jpg" class="relateImg" alt="基于React和Node实现一个食物热量参考应用">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/07/04/2018-07-04-technology-vpull-refresh/" title="基于vue封装的轻量级下拉刷新组件">
							基于vue封装的轻量级下拉刷新组件
						</a>
						<p>
							如何使用将项目中的src/components/pullRefresh.vue和src/img拷贝到你的工程内。如层级发生改变，你需要手动修改pullRefresh.vue中的图片链接地址。
API


属性
说明
类型
默认值


...
						</p>
					</div>

					<a href="/2018/07/04/2018-07-04-technology-vpull-refresh/" title="基于vue封装的轻量级下拉刷新组件">				
						<img src="/img/mescal/2.jpg" class="relateImg" alt="基于vue封装的轻量级下拉刷新组件">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/04/21/2018-04-21-technology-x-ui/" title="x-ui">
							x-ui
						</a>
						<p>
							跨平台的移动端ui组件库
介绍x-ui是基于react native和react开发出的跨android、ios和h5的三端ui组件库。
如何使用起步git clone https://github.com/mescalchuan/x...
						</p>
					</div>

					<a href="/2018/04/21/2018-04-21-technology-x-ui/" title="x-ui">				
						<img src="/img/mescal/3.jpg" class="relateImg" alt="x-ui">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/02/25/2018-02-25-technology-angular-m-cli/" title="一个能够快速构建AngularJS多页项目的轻量级脚手架">
							一个能够快速构建AngularJS多页项目的轻量级脚手架
						</a>
						<p>
							
一款基于webpack的快速构建angular1的多页应用构建方案文档地址使用angular-m-cli，您可以做到
快速构建项目原型
自动生成新页面并完成相关配置（包括入口文件、css、index.html）
利用本地服务器完成开...
						</p>
					</div>

					<a href="/2018/02/25/2018-02-25-technology-angular-m-cli/" title="一个能够快速构建AngularJS多页项目的轻量级脚手架">				
						<img src="/img/mescal/4.jpg" class="relateImg" alt="一个能够快速构建AngularJS多页项目的轻量级脚手架">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/01/27/2018-01-27-technology-atom/" title="优雅地配置Atom">
							优雅地配置Atom
						</a>
						<p>
							从最初的sublime text，到webstorm，后来又转战visual studio code，直到现在的atom，就个人使用体验来看是越来越舒适的。之前一直在使用sublime text和webstorm，后来尝试了一把vs ...
						</p>
					</div>

					<a href="/2018/01/27/2018-01-27-technology-atom/" title="优雅地配置Atom">				
						<img src="/img/mescal/5.jpg" class="relateImg" alt="优雅地配置Atom">
					</a>
				</li>											
		
		
				<li>
					<div>
						<a href="/2018/01/19/2018-01-19-technology-react-native-textinput/" title="React Native之巧用TextInput">
							React Native之巧用TextInput
						</a>
						<p>
							近日使用rn开发电商app遇到一个再简单不过的需求：买家申请退款，填写申请单，其中有一个多行文本输入框用于填写退款理由，如图所示：

看似简单的需求，然而用rn开发还是会遇到问题。
页面搭建两个View和一个TextInput足矣，外...
						</p>
					</div>

					<a href="/2018/01/19/2018-01-19-technology-react-native-textinput/" title="React Native之巧用TextInput">				
						<img src="/img/mescal/6.jpg" class="relateImg" alt="React Native之巧用TextInput">
					</a>
				</li>											
		
		
	</ul>
</div>	
			</div>
			<div class="investment-content-list">
				<div class="layout-comment">

	

</div>
			</div>
		</div>	
	</div>
</div>



	<!-- leancloud -->
	<!--
	时间：2018-11-27
	描述：
		文章访问量：visitors
		文章喜欢量：likes	
		文章排行榜：topNPost
		其他得说明：
			01-Cookie相关的函数 
				https://blog.csdn.net/somehow1002/article/details/78511541（Author：somehow1002）
			02-visitors相关的函数 
				https://blog.csdn.net/u013553529/article/details/63357382（Author：爱博客大伯）
				https://notes.doublemine.me/2015-10-21-为NexT主题添加文章阅读量统计功能.html（Author：夏末）
			03-topNPost相关的函数
				https://hoxis.github.io/hexo-next-read-rank.html（Author：hoxis）
			04-likes相关的函数，
				参考了01 & 02进行简单的设计与实现
-->



 

<!-- show math formula -->




<!-- TODO: There seems to be a bug when you close the post gallery! -->
<link rel="stylesheet" href="/plugin/lightgallery/css/lightgallery.css">
<script src="/plugin/lightgallery/js/jquery-1.11.0.min.js"></script>
<script src="/plugin/lightgallery/js/lightgallery-all.min.js"></script>

<script type="text/javascript">
	var postTitle = $('.article-title a').text() ? $('.article-title a').text() : "No post title!";
	$('.article-content img').each(function() {
		var imgPath = $(this).attr('src'),
			imgTitle = $(this).attr('alt') ? $(this).attr('alt') : "No image description!";
		$(this).wrap('<div class="img-responsive" data-src="' + imgPath + '" data-responsive="' + imgPath + '" data-sub-html="<p>图片 ' + imgTitle + '</p><h4>文章' + postTitle + '</h4>"></div>');
	});

	$('.article-content').lightGallery({
		mode: 'lg-slide',
		selector: '.img-responsive',
		share: false,
		zoom: false,
		download: false
	});
	//TODO：支持video
</script>

<!--
	时间：2018-11-17
	描述：
		插件名称：katelog.min.js
		插件作者：KELEN
		插件来源: https://github.com/KELEN/katelog
-->

		

		<div class="k-catelog-list" id="catelog-list" data-title="文章目录"></div>
		<script src="/plugin/toc/katelog.min.js"></script>

		
	
			<audio loop="loop" controls>
				<source src="/xingzhezui.mp3" type="audio/mp3" />
			</audio>
		</main>
		
		<!--footer-->
		<footer>
	<div class="social">
		<ul>
	
		
			<li>
				<a href="https://github.com/mescalchuan" title="Github" target="_blank">
					<i class="fa fa-github"></i>
				</a>
			</li>
		
		
			<li>
				<a href="https://weibo.com/6454388854/profile?topnav=1&wvr=6" title="Weibo" target="_blank">
					<i class="fa fa-weibo"></i>
				</a>
			</li>
		
		
			<li>
				<a href="mailto:/1335382915@qq.com" title="Email" target="_blank">
					<i class="fa fa-envelope-o"></i>
				</a>
			</li>
		

		
			<li>
				<a href="javasvript:void(0)" title="QQ" target="_blank" data-remodal-target="modalQ">
					<i class="fa fa-qq"></i>
				</a>
			</li>
		
		
			<li>
				<a href="javasvript:void(0)" title="WeiXin" target="_blank" data-remodal-target="modalW">
					<i class="fa fa-weixin"></i>
				</a>
			</li>
		
		
			<li>
				<a href="https://mescalchuan.github.io" title="Website">
					<i class="fa fa-globe"></i>
				</a>
			</li>
		
		
	 
</ul>
	</div>
		
	<div class="copyright">
		<p>
			 
				&copy;2019, content by Mescal Chuan. All Rights Reserved.
			
			
			

	<!-- busuanzi -->
	<!-- busuanzi -->



		</p>
		<!-- <p>
			<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay. 					
		</p> -->
	</div>	

	<div class="remodal" data-remodal-id="modalQ">
		<img style="max-width:100%;height:auto;" src="/img/mescal/qq.jpeg" alt>
	</div>
	<div class="remodal" data-remodal-id="modalW">
		<img style="max-width:100%;height:auto;" src="/img/mescal/weixin.jpg" alt>
	</div>
</footer>
		
    <!-- set '1' to show motto in all pages! -->

	<script src="/js/motto.js"></script>
	<script type="text/javascript">
		$(".motto").html( getMingYanContent() );
	</script>	




    <!--
	时间：2018-10-3
	描述：
		插件名称：hexo-generator-search-zip
		插件来源: https://github.com/SuperKieran/hexo-generator-search-zip
		代码参考：https://github.com/SuperKieran/TKL/blob/master/layout/_partial/search.ejs(Include: js & css)	
-->
<div class="popup search-popup local-search-popup">
	<div class="local-search-container">
		<span class="popup-btn-close">
      ESC
   </span>
		<div class="local-search-header">
			<input autocomplete="off" placeholder="Search..." type="text" id="local-search-input">
		</div>
		<div class="local-search-body">
			<div id="local-search-output"></div>
		</div>
		<div class="local-search-footer">
			

		</div>
	</div>
</div>

<script src="/js/ziploader.js"></script>
<script src="/js/search.js"></script>

<script type="text/javascript">
	var search_path = 'search.json',
		zip_Path = '/search.zip',
		version_Path = '/searchVersion.txt',
		input_Trigger = 'auto',
		top_N = '2';

	themeLocalSearch({
		search_path, 
		zip_Path, 
		version_Path, 
		input_Trigger, 
		top_N
	});
</script>




<!--back to top-->

    
	<div id="totop">
  		<a href="javascript:;" name="TOTOP" class="fa fa-arrow-up"></a>
	</div>
	<div id="tobuttom">
		<a href="javascript:;" name="TOBUTTOM" class="fa fa-arrow-down"></a>
	</div>
 


 

<script src="/js/vibrant.js"></script>
<script src="/js/chinese.js"></script>
<script src="/js/main.js"></script>
		<script src="/js/prism.js"></script>	
		<script src="/js/remodal.js"></script>  
	</body>
	</html>
