<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>元编程 | Mescal Chuan</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/interview/assets/css/0.styles.ae1d6bd4.css" as="style"><link rel="preload" href="/interview/assets/js/app.3bc2226e.js" as="script"><link rel="preload" href="/interview/assets/js/2.e749d065.js" as="script"><link rel="preload" href="/interview/assets/js/12.2185b6ad.js" as="script"><link rel="prefetch" href="/interview/assets/js/10.942cced8.js"><link rel="prefetch" href="/interview/assets/js/11.2e8095f6.js"><link rel="prefetch" href="/interview/assets/js/13.c8c32d05.js"><link rel="prefetch" href="/interview/assets/js/14.2b5d44e8.js"><link rel="prefetch" href="/interview/assets/js/15.80e6d511.js"><link rel="prefetch" href="/interview/assets/js/16.0f9b67f4.js"><link rel="prefetch" href="/interview/assets/js/17.695f1afb.js"><link rel="prefetch" href="/interview/assets/js/18.547e50a8.js"><link rel="prefetch" href="/interview/assets/js/19.782a1613.js"><link rel="prefetch" href="/interview/assets/js/20.71ef5c40.js"><link rel="prefetch" href="/interview/assets/js/21.3f642435.js"><link rel="prefetch" href="/interview/assets/js/22.eaffdbf4.js"><link rel="prefetch" href="/interview/assets/js/23.06952d4c.js"><link rel="prefetch" href="/interview/assets/js/24.b507ca4b.js"><link rel="prefetch" href="/interview/assets/js/25.14296b43.js"><link rel="prefetch" href="/interview/assets/js/26.b426679e.js"><link rel="prefetch" href="/interview/assets/js/27.d6bf5e1a.js"><link rel="prefetch" href="/interview/assets/js/28.0252745a.js"><link rel="prefetch" href="/interview/assets/js/29.43eafb8c.js"><link rel="prefetch" href="/interview/assets/js/3.b1e226e7.js"><link rel="prefetch" href="/interview/assets/js/30.7f45edf9.js"><link rel="prefetch" href="/interview/assets/js/31.57835c35.js"><link rel="prefetch" href="/interview/assets/js/32.2898b340.js"><link rel="prefetch" href="/interview/assets/js/33.72e8ac0b.js"><link rel="prefetch" href="/interview/assets/js/34.235ef067.js"><link rel="prefetch" href="/interview/assets/js/35.9d60e62b.js"><link rel="prefetch" href="/interview/assets/js/36.b18d596f.js"><link rel="prefetch" href="/interview/assets/js/37.c1b3eb86.js"><link rel="prefetch" href="/interview/assets/js/38.851336b5.js"><link rel="prefetch" href="/interview/assets/js/39.727fc25b.js"><link rel="prefetch" href="/interview/assets/js/4.3c768172.js"><link rel="prefetch" href="/interview/assets/js/40.24ebf04b.js"><link rel="prefetch" href="/interview/assets/js/41.125c6fed.js"><link rel="prefetch" href="/interview/assets/js/42.64e7c2b4.js"><link rel="prefetch" href="/interview/assets/js/43.34e7ea17.js"><link rel="prefetch" href="/interview/assets/js/44.d6c8cc3a.js"><link rel="prefetch" href="/interview/assets/js/45.d1483dd8.js"><link rel="prefetch" href="/interview/assets/js/46.636e4ac7.js"><link rel="prefetch" href="/interview/assets/js/47.2da152ba.js"><link rel="prefetch" href="/interview/assets/js/48.071a3abb.js"><link rel="prefetch" href="/interview/assets/js/49.72476ffb.js"><link rel="prefetch" href="/interview/assets/js/5.9979bf71.js"><link rel="prefetch" href="/interview/assets/js/50.b9fa70b7.js"><link rel="prefetch" href="/interview/assets/js/51.1c063068.js"><link rel="prefetch" href="/interview/assets/js/52.122408a8.js"><link rel="prefetch" href="/interview/assets/js/53.f8158742.js"><link rel="prefetch" href="/interview/assets/js/54.c16cdb66.js"><link rel="prefetch" href="/interview/assets/js/55.63d5d3ff.js"><link rel="prefetch" href="/interview/assets/js/56.6ef79955.js"><link rel="prefetch" href="/interview/assets/js/57.926e2d82.js"><link rel="prefetch" href="/interview/assets/js/58.360b2b95.js"><link rel="prefetch" href="/interview/assets/js/59.23ceba40.js"><link rel="prefetch" href="/interview/assets/js/6.6702183f.js"><link rel="prefetch" href="/interview/assets/js/60.dd34afe8.js"><link rel="prefetch" href="/interview/assets/js/61.722a6eca.js"><link rel="prefetch" href="/interview/assets/js/62.a3f4ca86.js"><link rel="prefetch" href="/interview/assets/js/63.c611230f.js"><link rel="prefetch" href="/interview/assets/js/64.3adfd01e.js"><link rel="prefetch" href="/interview/assets/js/65.f64224eb.js"><link rel="prefetch" href="/interview/assets/js/66.37d15fa5.js"><link rel="prefetch" href="/interview/assets/js/67.f90ab7b9.js"><link rel="prefetch" href="/interview/assets/js/68.57421fa7.js"><link rel="prefetch" href="/interview/assets/js/69.052a2799.js"><link rel="prefetch" href="/interview/assets/js/7.386421b9.js"><link rel="prefetch" href="/interview/assets/js/70.0e9d3d49.js"><link rel="prefetch" href="/interview/assets/js/71.dbcb35f8.js"><link rel="prefetch" href="/interview/assets/js/72.6862ec21.js"><link rel="prefetch" href="/interview/assets/js/73.6ba180de.js"><link rel="prefetch" href="/interview/assets/js/74.5d0a0247.js"><link rel="prefetch" href="/interview/assets/js/75.60d30dc8.js"><link rel="prefetch" href="/interview/assets/js/8.087ba7c4.js"><link rel="prefetch" href="/interview/assets/js/9.8b991193.js">
    <link rel="stylesheet" href="/interview/assets/css/0.styles.ae1d6bd4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview/" class="home-link router-link-active"><!----> <span class="site-name">Mescal Chuan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/mescalchuan/css-block" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/mescalchuan/css-block" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/mobile/viewport.html" class="sidebar-link">响应式 web 设计实战</a></li><li><a href="/interview/mobile/flex.html" class="sidebar-link">Flex</a></li><li><a href="/interview/mobile/h5.html" class="sidebar-link">H5 的坑</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>日常积累</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/days/js/curry.html" class="sidebar-link">柯里化</a></li><li><a href="/interview/days/js/eventloop.html" class="sidebar-link">Event Loop</a></li><li><a href="/interview/days/js/lastcall.html" class="sidebar-link">尾调用优化</a></li><li><a href="/interview/days/js/microtask.html" class="sidebar-link">宏微任务</a></li><li><a href="/interview/days/js/module.html" class="sidebar-link">模块</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Http</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/interview/order.html" class="sidebar-link">工单</a></li><li><a href="/interview/interview/js.html" class="sidebar-link">总结 JS</a></li><li><a href="/interview/interview/htmlcss.html" class="sidebar-link">HTML + CSS</a></li><li><a href="/interview/interview/opt.html" class="sidebar-link">总结优化</a></li><li><a href="/interview/interview/angular.html" class="sidebar-link">Angular</a></li><li><a href="/interview/interview/vue.html" class="sidebar-link">Vue</a></li><li><a href="/interview/interview/react.html" class="sidebar-link">React</a></li><li><a href="/interview/interview/mobile.html" class="sidebar-link">移动端开发</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Css 世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/cssworld/1.html" class="sidebar-link">流、元素与基本尺寸</a></li><li><a href="/interview/cssworld/2.html" class="sidebar-link">盒尺寸四大家族</a></li><li><a href="/interview/cssworld/3.html" class="sidebar-link">内部元素与流</a></li><li><a href="/interview/cssworld/4.html" class="sidebar-link">流的破坏与保护</a></li><li><a href="/interview/cssworld/5.html" class="sidebar-link">层叠规则</a></li><li><a href="/interview/cssworld/6.html" class="sidebar-link">文本处理</a></li><li><a href="/interview/cssworld/7.html" class="sidebar-link">元素的显示与隐藏</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高效前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/efficient/htmlcss.html" class="sidebar-link">HTML CSS 优化</a></li><li><a href="/interview/efficient/jsopt.html" class="sidebar-link">JS 优化</a></li><li><a href="/interview/efficient/pageopt.html" class="sidebar-link">页面优化</a></li><li><a href="/interview/efficient/html5opt.html" class="sidebar-link">HTML5 优化</a></li><li><a href="/interview/efficient/base.html" class="sidebar-link">前端与计算机基础</a></li><li><a href="/interview/efficient/febase.html" class="sidebar-link">前端基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>你不知道的 Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>上</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>中</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>下</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/ydkjs/xia/1.html" class="sidebar-link">总结</a></li><li><a href="/interview/ydkjs/xia/2-2.html" class="sidebar-link">语法</a></li><li><a href="/interview/ydkjs/xia/2-3.html" class="sidebar-link">代码组织</a></li><li><a href="/interview/ydkjs/xia/2-4.html" class="sidebar-link">Promise</a></li><li><a href="/interview/ydkjs/xia/2-5.html" class="sidebar-link">集合</a></li><li><a href="/interview/ydkjs/xia/2-6.html" class="sidebar-link">新增 API</a></li><li><a href="/interview/ydkjs/xia/2-7.html" class="active sidebar-link">元编程</a></li><li><a href="/interview/ydkjs/xia/2-8.html" class="sidebar-link">ES6 之后</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>手写代码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/write/promise.html" class="sidebar-link">Promise</a></li><li><a href="/interview/write/copy.html" class="sidebar-link">深拷贝</a></li><li><a href="/interview/write/bind.html" class="sidebar-link">Bind</a></li><li><a href="/interview/write/throttledebounce.html" class="sidebar-link">节流与防抖</a></li><li><a href="/interview/write/suanfa.html" class="sidebar-link">常见算法</a></li><li><a href="/interview/write/array.html" class="sidebar-link">数组相关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目经验</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/expires/click.html" class="sidebar-link">自定义树形下拉框</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="元编程"><a href="#元编程" class="header-anchor">#</a> 元编程</h1> <p>元编程：操作程序本身行为特性的编程
元编程关注以下几点：代码查看自身、代码修改自身、代码修改默认特性、影响其他代码</p> <h4 id="元属性new-target"><a href="#元属性new-target" class="header-anchor">#</a> 元属性new.target</h4> <p>new.target总是访问真正new的目标的上下文</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> parent<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Parent instantiated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Child instantiated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Parent instantiated</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Child instantiated</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="公开符号"><a href="#公开符号" class="header-anchor">#</a> 公开符号</h4> <p>symbol对外提供了一些公共的符号
<code>Symbol.iterator</code>
例如...、for...of都是自动使用Symbol.iterator的，它是对象上的一个专门属性，它会自动查找对象上有没有一个方法（可以构造一个迭代器来消耗这个对象的值）。你也可以重写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Symbol.toStringTag</code>和<code>Symbol.hasInstance</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[object Object]</span>
a instanceOf Foo<span class="token punctuation">;</span> <span class="token comment">//true</span>
﻿
<span class="token comment">//Symbol.toStringTag和Symbol.hasInstance更改上述结果</span>
<span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Foo&quot;</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//必须使用Object.defineProperty来使用Symbol.hasInstance，因为Function.prototype上的那个的writable是false</span>
<span class="token comment">//obj就是FOO的实例，比如是a、b</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;cool&quot;</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>toString<span class="token punctuation">;</span> <span class="token comment">//[object Foo];</span>
b<span class="token punctuation">.</span>toString<span class="token punctuation">;</span> <span class="token comment">//[object cool];</span>
a <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
b <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>Symbol.toPrimitive</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//1,2,3,4,510</span>
﻿
arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//默认期望的运算类型，在这里是default，也是number</span>
    <span class="token comment">//对于arr + 10来说，hint是default（number）</span>
    <span class="token comment">//对于arr * 10来说，hint是number</span>
    <span class="token comment">//对于String(arr)来说，hint是string</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;default&quot;</span> <span class="token operator">||</span> hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> acc <span class="token operator">+</span> curr <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
arr <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//25</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>Symbol.isConcatSpreadable</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1, 2, 3, 4, 5, 6];</span>
b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1, 2, 3, [4, 5, 6]]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p></p> <h4 id="代理"><a href="#代理" class="header-anchor">#</a> 代理</h4> <p>代理是一种特殊的对象，它封装了一个普通的对象，作为该普通对象的拦截器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pobj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//拦截obj的get方法做出一系列操作后通过Reflect.get转发该操作（在这里是到默认操作上）</span>
obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">//1</span>
pobj<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">//{a: 1} a</span>
<span class="token comment">//1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>每一个代理trap都有一个与之同名的Reflect api，在这里是get</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//列举Proxy可用trap</span>
<span class="token number">1.</span>get：在代理上访问一个属性：Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>、obj<span class="token punctuation">[</span><span class="token punctuation">]</span>、obj<span class="token punctuation">.</span>
<span class="token number">2.</span>set：在代理上设置一个属性：为对象赋值或解构等操作
<span class="token number">3.</span>deleteProperty：从代理对象上删除一个属性
<span class="token number">4.</span>Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>或<span class="token keyword">delete</span> obj
<span class="token number">5.</span>apply（如果目标是函数的话）：将代理作为普通函数调用
<span class="token number">6.</span>Reflect<span class="token punctuation">.</span>apply、Reflect<span class="token punctuation">.</span>call、func<span class="token punctuation">.</span>apply、func<span class="token punctuation">.</span>call
<span class="token number">7.</span>defineProperty
<span class="token number">8.</span>getPrototypeOf
<span class="token number">9.</span>setPrototypeOf
<span class="token number">10.</span>has
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可取消的代理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;accessing: &quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//普通的代理是new Proxy()创建，而可取消代理只能这样创建</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span>proxy<span class="token operator">:</span> pobj<span class="token punctuation">,</span> revoke<span class="token operator">:</span> prevoke<span class="token punctuation">}</span> <span class="token operator">=</span> Proxy<span class="token punctuation">.</span><span class="token function">revocable</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">//accessing: a</span>
<span class="token comment">//1</span>
<span class="token function">prevoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">//TypeError</span>
<span class="token comment">//一旦代理被取消，所有对代理的操作均会TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>使用代理
日常中，建议实际操作的是代理，而元对象被隐藏起来</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//代理在先（首先与、主要或完全代理交互）</span>
<span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//过滤掉标点符号</span>
            <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[^\w]/g</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            val <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> target<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
﻿
<span class="token keyword">var</span> message_proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
message_proxy<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;hello...&quot;</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">&quot;wOrlD!!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WoRlD!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//遍历message_proxy</span>
<span class="token comment">//hello world</span>
<span class="token comment">//遍历messages</span>
<span class="token comment">//hello... world!!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//代理在后（代码只能与主对象交互，实在不行了再与代理交互）</span>
<span class="token keyword">var</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> receiver<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">&quot;!&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> catchall <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//换成greeter结果也一样</span>
<span class="token keyword">var</span> greeter <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token parameter">who</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> who<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>greeter<span class="token punctuation">,</span> catchall<span class="token punctuation">)</span><span class="token punctuation">;</span>
greeter<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello undefined</span>
greeter<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello world</span>
greeter<span class="token punctuation">.</span><span class="token function">everyone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello everyone!</span>
<span class="token comment">//代理作为greeter的原型，用户直接与greeter交流，而greeter没有everyone方法，js会顺着原型链找到代理查看代理有没有这个属性，此时会触发代理的get</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>No such property or method</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//有时候，我们期望只有属性存在的时候才对该属性进行操作</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token string">'No such property/method'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token string">'No such property/method'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> pobj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
pobj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//Error: no such property/method</span>
pobj<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Error: no such property/method</span>
﻿
<span class="token comment">//代理在后</span>
<span class="token keyword">var</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string">'No such property/method'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string">'No such property/method'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
pobj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">setProtytypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> pobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
pobj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
pobj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//Error: no such property/method</span>
pobj<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Error: no such property/method</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>代理[[proptotype]]链</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//[[prototype]]机制的原理就是[[Get]]运算，当对象自身没有某个属性时，[[Get]]会自动把这个运算转给[[prototype]]处理</span>
<span class="token comment">//我们可以用代理做一个原型环</span>
<span class="token keyword">var</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//直接对象没有该属性，则访问我们自定义的原型</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> target<span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;[[Prototype]]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'obj-1'</span><span class="token punctuation">,</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'obj-2'</span><span class="token punctuation">,</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;[[Prototype]]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj2<span class="token punctuation">;</span>
<span class="token comment">//现在，obj2.prototype是obj1，而obj1的Symbol(&quot;[[Prototype]]&quot;)是obj2</span>
<span class="token comment">//当obj1某个属性没有时，会代理到Symbol(&quot;[[Prototype]]&quot;)上，也就是obj2上</span>
obj1<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//bar: obj1 </span>
<span class="token comment">//foo: obj1</span>
<span class="token comment">//因为obj1有name，所以访问的是obj1的name</span>
﻿
obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//foo: obj2</span>
<span class="token comment">//因为obj12没有foo，通过Prototype访问obj1的foo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//不用原型环，应用：为一个对象创建多个“Prototype”</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'obj-1'</span><span class="token punctuation">,</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj1.foo: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'obj-2'</span><span class="token punctuation">,</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj2.foo'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj2.bar'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> target<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;[[Prototype]]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'obj-3'</span><span class="token punctuation">,</span>
    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> handlers<span class="token punctuation">)</span>
obj3<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;[[Prototype]]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">]</span>
obj3<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//obj1.foo: obj-3</span>
<span class="token comment">//obj2.bar: obj-3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p></p> <h4 id="reflect-api"><a href="#reflect-api" class="header-anchor">#</a> Reflect API</h4> <p>设计初衷：</p> <ul><li>将Object对象的一些明显属于语言内部的方法（比如Object.defineProperty），放到Reflect对象上，未来所有操作内部api的事情全部交由Reflect来做，而不是Object.。</li> <li>修改了某些Object方法的返回结果，让其变得更合理。
﻿
Reflect的api与Proxy的trap一一对应，参考Proxy的那些trap。
Reflect API的第一个参数永远是目标对象，如果它不是一个对象，则会报错。
﻿
属性排序</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//一般的，对象的属性列出顺序是依赖于定义顺序的</span>
<span class="token comment">//而我们可以使用Reflect.ownKeys将列出顺序改为es6的[[OwnPropertyKeys]]算法列出的顺序</span>
<span class="token comment">//Object.getOwnPropertyNames和Object.getOwnPropertySymbols也是按照该算法，只不过它们只能列出各自的</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;yay&quot;</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token string">&quot;awesome&quot;</span><span class="token punctuation">,</span>
    a<span class="token operator">:</span> <span class="token string">&quot;cool&quot;</span>
<span class="token punctuation">}</span>
Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1, 2, &quot;b&quot;, &quot;a&quot;, Symbol(c)]</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1, 2, &quot;b&quot;, &quot;a&quot;]</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[Symbol(c)]</span>
﻿
<span class="token comment">//JSON.stringify(obj)不会考虑obj的原型链，它只会stringify obj自身的属性并返回</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="尾调用"><a href="#尾调用" class="header-anchor">#</a> 尾调用</h4> <p>尾调用的概念非常简单，一句话就能说清楚，就是指某个函数的最后一步是调用另一个函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//函数f的最后一步是调用函数g，这就叫尾调用。</span>
﻿
<span class="token comment">//下面的都不是尾调用</span>
﻿
<span class="token comment">// 情况一</span>
<span class="token comment">//调用g后，将其赋值给y然后再返回y</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
﻿
<span class="token comment">// 情况二</span>
<span class="token comment">//调用g后，将结果+1再返回</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>尾调用不一定出现在函数尾部，只要是最后一步操作即可。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">m</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">n</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//上面代码中，函数m和n都属于尾调用，因为它们都是函数f的最后一步操作。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>尾调用之所以与其他调用不同，就在于它的特殊的调用位置。
我们知道，函数调用会在内存形成一个&quot;调用记录&quot;，又称&quot;调用帧&quot;（call frame），保存调用位置和内部变量等信息。如果在函数A的内部调用函数B，那么在A的调用记录上方，还会形成一个B的调用记录。等到B运行结束，将结果返回到A，B的调用记录才会消失。如果函数B内部还调用函数C，那就还有一个C的调用记录栈，以此类推。所有的调用记录，就形成一个<a href="http://zh.wikipedia.org/wiki/%E8%B0%83%E7%94%A8%E6%A0%88" target="_blank" rel="noopener noreferrer">&quot;调用栈&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（call stack）。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>尾调用由于是函数的最后一步操作，所以不需要保留外层函数的调用记录，因为调用位置、内部变量等信息都不会再用到了，只要直接用内层函数的调用记录，取代外层函数的调用记录就可以了。
﻿
尾调用具体请参考<a href="http://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener noreferrer">阮一峰的尾调用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
﻿
﻿
EventLoop具体请参考<a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener noreferrer">阮一峰的EventLoop<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview/ydkjs/xia/2-6.html" class="prev">新增 API</a></span> <span class="next"><a href="/interview/ydkjs/xia/2-8.html">ES6 之后</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/interview/assets/js/app.3bc2226e.js" defer></script><script src="/interview/assets/js/2.e749d065.js" defer></script><script src="/interview/assets/js/12.2185b6ad.js" defer></script>
  </body>
</html>
